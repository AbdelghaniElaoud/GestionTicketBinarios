<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Welcome Page</title>
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
</head>
<body>
<h1>Welcome, </h1>

<div>
    <strong>Full Name:</strong>
    <span id="fullName"></span>
</div>
<div>
    <strong>Email:</strong>
    <span id="email"></span>
</div>
<div>
    <strong>Phone Number:</strong>
    <span id="phoneNumber"></span>
</div>

<h2>Tickets</h2>

<!-- Create a table for displaying tickets -->
<table class="table">
    <thead>
    <tr>
        <th>Ticket ID</th>
        <th>Name</th>
        <th>Status</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody id="ticketTableBody"></tbody>
</table>

<!-- Button to navigate to the "group" page -->
<button id="group" class="btn">Go to Group Page</button>

<script>

    const authToken = sessionStorage.getItem('authToken');

    const payload = decodeJwt(authToken);

    const token = sessionStorage.getItem('authToken');

    const fullName = payload.fullName;
    const email = payload.email;
    const phoneNumber = payload.phoneNumber;

    document.getElementById('fullName').textContent = fullName;
    document.getElementById('email').textContent = email;
    document.getElementById('phoneNumber').textContent = phoneNumber;

    const ticketTableBody = document.getElementById('ticketTableBody');

    // Fetch ticket data and display it in a table
    fetch('http://localhost:9090/api/ticket/tickets', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${authToken}`
        }
    })
        .then(response => response.json())
        .then(tickets => {
            tickets.forEach(ticket => {
                const row = document.createElement('tr');

                const ticketIDCell = document.createElement('td');
                ticketIDCell.textContent = ticket.id;
                row.appendChild(ticketIDCell);

                const nameCell = document.createElement('td');
                nameCell.textContent = ticket.name;
                row.appendChild(nameCell);

                const statusCell = document.createElement('td');
                statusCell.textContent = ticket.status;
                row.appendChild(statusCell);

                const actionCell = document.createElement('td');
                const detailsButton = document.createElement('button');
                detailsButton.textContent = 'Details';
                detailsButton.className = 'btn btn-primary';

                // Add a click event listener to the "Details" button
                detailsButton.addEventListener('click', function () {
                    // Handle the click event here, e.g., show ticket details
                    alert(`Ticket Details for ID ${ticket.id}: ${ticket.description}`);
                });

                actionCell.appendChild(detailsButton);
                row.appendChild(actionCell);

                ticketTableBody.appendChild(row);
            });
        })
        .catch(error => {
            console.error('Error fetching ticket data:', error);
        });

    const groupButton = document.getElementById('group');
    groupButton.addEventListener('click', function () {
        window.location.href = 'group'; // Replace with the correct URL
    });

    function decodeJwt(token) {
        const base64Payload = token.split(".")[1];
        const decodedPayload = atob(base64Payload);
        return JSON.parse(decodedPayload);
    }
</script>
</body>
</html>
