<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<p>Welcome</p>

<div>
    <strong>Full Name:</strong>
    <span id="fullName"></span>
</div>
<div>
    <strong>Email:</strong>
    <span id="email"></span>
</div>
<div>
    <strong>Phone Number:</strong>
    <span id="phoneNumber"></span>
</div>

<h2>Tickets</h2>
<ul id="ticketList"></ul>

<!-- Add a button to redirect to 'ticket' URL -->
<button id="ticketButton">Go to Ticket</button>

</body>
<script>

    const authToken = sessionStorage.getItem('authToken');

    const payload = decodeJwt(authToken);

    const token = sessionStorage.getItem('authToken');
    console.log(payload)
    const fullName = payload.fullName;
    const email = payload.email;
    const phoneNumber = payload.phoneNumber;

    document.getElementById('fullName').textContent = fullName;
    document.getElementById('email').textContent = email;
    document.getElementById('phoneNumber').textContent = phoneNumber;

    // Fetch ticket data and display it
    fetch('http://localhost:9090/api/ticket/tickets', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${authToken}`
        }
    })
        .then(response => response.json())
        .then(tickets => {
            const ticketList = document.getElementById('ticketList');
            tickets.forEach(ticket => {
                const listItem = document.createElement('li');
                listItem.textContent = `Ticket ID: ${ticket.id}, Name: ${ticket.name}, Status: ${ticket.status}`;
                ticketList.appendChild(listItem);
            });
        })
        .catch(error => {
            console.error('Error fetching ticket data:', error);
        });

    // Function to decode JWT token
    function decodeJwt(token) {
        const base64Payload = token.split(".")[1];
        const decodedPayload = atob(base64Payload);
        return JSON.parse(decodedPayload);
    }

    // Add an event listener to the button for redirection
    document.getElementById('ticketButton').addEventListener('click', function() {
        // Redirect to 'ticket' URL when the button is clicked
        window.location.href = 'ticket';
    });
</script>
</html>
